<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ipro.survey.persistence.dao.ProjectTaskDao">

    <sql id="columns">
      id,
      task_no as taskNo,
      status as status,
      user_account as userAccount,
      project_uniq_no as projectUniqNo,
      action_no as actionNo,
      create_time as createTime,
      notify_time as notifyTime,
      update_time as updateTime
    </sql>

    <select id="selectByTaskNo" resultType="com.ipro.survey.persistence.model.ProjectTask">
        SELECT
        <include refid="columns"/>
        FROM tb_project_task
        WHERE task_no = #{taskNo}
    </select>

    <select id="selectUserCurrentTask" resultType="com.ipro.survey.persistence.model.ProjectTask">
        SELECT
        <include refid="columns"/>
        FROM tb_project_task
        WHERE project_uniq_no = #{projectUniqNo} and schedule_count = #{scheduleCount} and user_account = #{userAccount}
    </select>

    <select id="selectUserAllTask" resultType="com.ipro.survey.persistence.model.ProjectTask">
        SELECT
        <include refid="columns"/>
        FROM tb_project_task
        WHERE project_uniq_no = #{projectUniqNo} and user_account = #{userAccount}
    </select>

    <update id="updateProjectTask" parameterType="com.ipro.survey.persistence.model.ProjectTask">
        update tb_project_task
        set status = #{status}
        WHERE task_no = #{taskNo}
    </update>

    <update id="resetTask" parameterType="com.ipro.survey.persistence.model.ProjectTask">
        update tb_project_task
        set status = 1
        WHERE project_uniq_no = #{projectUniqNo} and schedule_count = #{scheduleCount} and user_account = #{userAccount}
    </update>

    <insert id="insertTask" parameterType="com.ipro.survey.persistence.model.ProjectTask">
        INSERT INTO tb_project_task
        (
        task_no,
        status,
        user_account,
        project_uniq_no,
        schedule_count,
        action_no,
        create_time,
        notify_time
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.taskNo},
            #{item.status},
            #{item.userAccount},
            #{item.projectUniqNo},
            #{item.scheduleCount},
            #{item.actionNo},
            #{item.createTime},
            #{item.notifyTime}
            )
        </foreach>
    </insert>

</mapper>